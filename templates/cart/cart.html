{% extends "shop/base.html" %}
{% load static %}
{% block content %}
<div class="breadcrumb-area pt-95 pb-95 bg-img" style="background-image:url({% static 'shop/img/banners/banner-2.jpg' %});">
    <div class="container">
        <div class="breadcrumb-content text-center">
            <h2>Cart</h2>
            <ul>
                <li><a href="{% url 'shop:index' %}">home</a></li>
                <li class="active">Cart</li>
            </ul>
        </div>
    </div>
</div>
<div class="cart-main-area pt-95 pb-100">
    <div class="container">
        <h3 class="page-title">Your cart items</h3>
        {% if cart %}
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                <form action="{% url 'cart:cart_update' %}" method="post">
                    {% csrf_token %}
                    <div class="table-content table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Product Name</th>
                                    <th>Unit Price</th>
                                    <th>Qty</th>
                                    <th>Subtotal</th>
                                    <th>Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in cart %}
                                <tr>
                                    <td class="product-thumbnail">
                                        <a href="{{ item.product.get_absolute_url }}"><img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="width: 150px; height: auto;"></a>
                                    </td>
                                    <td class="product-name"><a href="{{ item.product.get_absolute_url }}">{{ item.product.name|truncatewords:3 }}</a></td>
                                    <td class="product-price-cart"><span class="amount">${{ item.price }}</span></td>
                                    <td class="product-quantity">
                                        <div class="cart-plus-minus">
                                            <input class="cart-plus-minus-box" type="number" name="quantity_{{ item.product.id }}" value="{{ item.quantity }}" min="1">
                                        </div>
                                    </td>
                                    <td class="product-subtotal">${{ item.total_price }}</td>
                                    <td class="product-remove">
                                        <a href="{% url 'cart:cart_remove' item.product.id %}"><i class="ti-trash"></i></a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="cart-shiping-update-wrapper">
                                <div class="cart-shiping-update">
                                    <a href="{% url 'shop:shop_page' %}">Continue Shopping</a>
                                    <button type="submit">Update Shopping Cart</button>
                                </div>
                                <div class="cart-clear">
                                    <a href="{% url 'cart:cart_clear' %}">Clear Shopping Cart</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="row">
                    {% if request.user.is_authenticated %}
                    <div class="col-lg-4 col-md-6">
                        <div class="discount-code-wrapper">
                            <h4 class="cart-bottom-title">DISCOUNT CODES</h4>
                            <div class="discount-code">
                                <p>Enter your coupon code if you have one.</p>
                                <form method="post" action="{% url 'cart:cart_detail' %}">
                                    {% csrf_token %}
                                    <input type="text" name="coupon_code" value="{% if coupon_code %}{{ coupon_code }}{% endif %}" required="">
                                    <button class="cart-btn-2" type="submit" {% if discount %} disabled {% endif %}>Apply Coupon</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    <div class="col-lg-4 col-md-12 offset-lg-4">
                        <div class="grand-totall">
                            <span>Subtotal: ${{ cart.get_total_price|floatformat:2 }}</span>
                            {% if discount %}
                                <span>Coupon Code Applied: {{ coupon_code }}</span>
                                <span>Discount: -${{ discount|floatformat:2 }}</span>
                            {% endif %}
                            <h5>Grand Total: ${{ grand_total|floatformat:2 }}</h5>
                            <a href="{% url 'orders:order_create' %}">Proceed To Checkout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="cart-empty-title" style="display: {% if cart %}none{% else %}block{% endif %};">
            <h2>Your cart is currently empty.</h2>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
